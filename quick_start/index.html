<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Quick Start - RDycore: Capturing the Dynamics of Compound Flooding in E3SM</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">RDycore: Capturing the Dynamics of Compound Flooding in E3SM</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/RDycore/RDycore.github.io" class="nav-link"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#quick-start" class="nav-link">Quick Start</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#step-1-design-an-experiment" class="nav-link">Step 1: Design an Experiment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-2-write-a-skywalker-program" class="nav-link">Step 2: Write a Skywalker Program</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-3-build-the-program" class="nav-link">Step 3: Build the Program</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-4-run-the-experiment" class="nav-link">Step 4: Run the Experiment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-5-analyze-the-results" class="nav-link">Step 5: Analyze the Results</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="quick-start">Quick Start</h1>
<p>Once you've successfully <a href="../installation/">installed Skywalker</a>, it's time to
write your first Skywalker program. Sometimes we refer to such a program as a
<em>driver</em>, since it's really just a way to run an algorithm or parameterization
that we want to study.</p>
<p>Let's get started.</p>
<h2 id="step-1-design-an-experiment">Step 1: Design an Experiment</h2>
<p>For simplicity, we are going to study a function of two variables</p>
<p>$$
f(x, y) = y \sin(x) - x \cos(y)
$$</p>
<p>over the domain $[-2\pi, 2\pi]\times[−2\pi, 2\pi]$. Our input parameters are
$x$ and $y$, and our output variable is $f$. We will sample points on a uniform
grid of evenly-spaced $x$ and $y$ values.</p>
<p>Suppose we want to sample $f$ at 100 $x$ values and 100 $y$ values, tracing out
the surface it represents above the euclidean plane. Here's a YAML file that
sets up the calculation of $f$ on these $(x, y)$ points:</p>
<p>=== "surface.yaml"
    <code>linenums="1"
    input:
      lattice:
        x: [-6.2831853, 6.2831853, 0.0628]
        y: [-6.2831853, 6.2831853, 0.0628]</code></p>
<p>Line 2 indicates that all values of $x$ are combined with all values of $y$.
Lines 3 and 4 define 100 uniformly-spaced values between $−2\pi$ and $2\pi$ for
$x$ and $y$. You can find detailed explanations of all these things in the
<a href="../input/">Input Format (YAML)</a> section.</p>
<p>This YAML input file reflects the design of our experiment. Now we just need a
Skywalker program that computes $f$ at each of the points we've specified.</p>
<h2 id="step-2-write-a-skywalker-program">Step 2: Write a Skywalker Program</h2>
<p>A Skywalker program creates an <strong>ensemble</strong> of complete sets of inputs (in this
case, the point $(x, y)$ in $\mathbb{R}^2$). Each point represents a <strong>member</strong>
of the ensemble. The program loops over each ensemble members $(x, y)$ and
computes the output $f$ for it. Finally, it writes all of its ensemble data
(all values of $x$, $y$, and $f$) to a <a href="../output/">Python module</a> that can
be used for postprocessing. The data in the module is ordered in such a way that
each output is associated with its inputs.</p>
<p>Here's a program that does all of these things, written in C, C++, and Fortran.
Pick your favorite language, paste the corresponding code into a text editor,
and save it to a file with the indicated name.</p>
<p>=== "C (surface.c)"
    ``` c linenums="1"
    #include <skywalker.h>
    #include <math.h></p>
<pre><code>int main(int argc, char **argv) {
  // Specify the name of the input file.
  const char *input_file = "surface.yaml";

  // Load the ensemble, exiting if the operation fails.
  sw_ensemble_result_t load_result = sw_load_ensemble(input_file, NULL);
  if (load_result.error_code != SW_SUCCESS) {
    fprintf(stderr, "Error: %s", load_result.error_message);
    exit(-1);
  }

  // Iterate over all members of the ensemble.
  sw_ensemble_t *ensemble = load_result.ensemble;
  sw_input_t *input;
  sw_output_t *output;
  while (sw_ensemble_next(ensemble, &amp;input, &amp;output)) {
    // Fetch input values.
    sw_input_result_t result = sw_input_get(input, "x");
    if (result.error_code != SW_SUCCESS) {
      fprintf(stderr, "Error: %s", load_result.error_message);
      exit(-1);
    }
    sw_real_t x = result.value;
    result = sw_input_get(input, "y");
    if (result.error_code != SW_SUCCESS) {
      fprintf(stderr, "Error: %s", load_result.error_message);
      exit(-1);
    }
    sw_real_t y = result.value;

    // Compute f(x, y).
    sw_real_t f = y * sin(x) - x * cos(y);

    // Store f as an output variable.
    sw_output_set(output, "f", f);
  }

  // Write a Python module containing the input/output data.
  const char *output_file = "surface.py";
  sw_write_result_t w_result = sw_ensemble_write(ensemble, output_file);
  if (w_result.error_code != SW_SUCCESS) {
    fprintf(stderr, "Error: %s", load_result.error_message);
    exit(-1);
  }

  // Clean up.
  sw_ensemble_free(ensemble);

  return 0;
}
```
</code></pre>
<p>=== "C++ (surface.cpp)"
    ``` c++ linenums="1"
    #include <skywalker.hpp>
    #include <cmath>
    #include <iostream></p>
<pre><code>int main(int argc, char **argv) {
  // Specify the name of the input file.
  std::string input_file = "surface.yaml";

  // Load the ensemble, exiting if the operation fails.
  skywalker::Ensemble *ensemble = nullptr;
  try {
    ensemble = skywalker::load_ensemble(input_file);

    // Iterate over all members of the ensemble. We define a lambda function
    // that operates on the input and output variables for each member.
    ensemble-&gt;process([](const skywalker::Input &amp;input,
                         skywalker::Output &amp;output) {
      // Fetch input values.
      skywalker::Real x = input.get("x");
      skywalker::Real y = input.get("y");

      // Compute f(x, y).
      skywalker::Real f = y * std::sin(x) - x * std::cos(y);

      // Store f as an output variable.
      output.set("f", f);
    });

    // Write a Python module containing the input/output data.
    std::string output_file = "surface.py";
    ensemble-&gt;write(output_file);

    // Clean up.
    delete ensemble;
  } catch (skywalker::Exception&amp; e) {
    std::cerr &lt;&lt; "Error: " &lt;&lt; e.what() &lt;&lt; std::endl;
    exit(-1);
  }

  return 0;
}
```
</code></pre>
<p>=== "Fortran (surface.F90)"
    ``` fortran linenums="1"
    program surface
      use skywalker
      implicit none</p>
<pre><code>  character(len=255)      :: input_file, output_file
  type(ensemble_result_t) :: load_result
  type(ensemble_t)        :: ensemble
  type(input_t)           :: input
  type(output_t)          :: output
  real(swp)               :: x, y, f

  ! Specify the name of the input file.
  input_file = "surface.yaml"

  ! Load the ensemble, exiting if the operation fails.
  load_result = load_ensemble(trim(input_file))
  if (load_result%error_code /= SW_SUCCESS) then
    print *, "Error: ", trim(load_result%error_message)
    stop
  end if

  ! Iterate over all members of the ensemble.
  ensemble = load_result%ensemble
  do while (ensemble%next(input, output))
    ! Fetch inputs.
    x = input%get("x")
    y = input%get("y")

    ! Compute f(x, y).
    f = y * sin(x) - x * cos(y)

    ! Store f as an output variable.
    call output%set("f", f);
  end do

  ! Write out a Python module.
  output_file = "surface.py"
  call ensemble%write(output_file)

  ! Clean up.
  call ensemble%free();
end program
```
</code></pre>
<p>The <a href="../api/">API</a> section discusses each of the elements in this program. For
now, let's just try to build it and run it.</p>
<h2 id="step-3-build-the-program">Step 3: Build the Program</h2>
<p>Everyone has their own setup for building programs, so let's keep it simple:
we'll compile the program and link it against the appropriate Skywalker library
(or libraries) in one step:</p>
<p>=== "C"
    <code>cc surface.c -I/path/to/include -L/path/to/lib -lskywalker_double -o surface</code>
=== "C++"
    <code>c++ surface.cpp -std=c++11 -I/path/to/include -L/path/to/lib -lskywalker_double -o surface</code>
=== "Fortran"
    <code>gfortran surface.F90 -I/path/to/include -L/path/to/lib -lskywalker_f90_double -lskywalker_double -o surface</code></p>
<p>If you use a different compiler, substitute it above. A few things to note:</p>
<ul>
<li>
<p>The C++ Skywalker program uses lambda functions, which requires at least
  C++11.</p>
</li>
<li>
<p>The <code>-I</code> flags above indicate the location of the Skywalker headers
  (<code>skywalker.h</code>, <code>skywalker.hpp</code>) and modules (<code>skywalker.mod</code>) you installed
  in the <a href="../installation/">Installation</a> section. So if you set Skywalker's
  <code>CMAKE_INSTALL_PREFIX</code> to <code>/usr/local</code>, you would use <code>-I/usr/local/include</code>.</p>
</li>
<li>
<p>Likewise, the <code>-L</code> flags tell the linker where to find the Skywalker
  libraries. If your <code>CMAKE_INSTALL_PREFIX</code> is <code>/usr/local</code>, indicate this with
  <code>-L/usr/local/lib</code>.</p>
</li>
<li>
<p>The <code>-l</code> parameter indicates the library to link your program against. C and
  C++ programs must be linked against <code>libskywalker_double.a</code>, while Fortran
  programs must additionally use <code>libskywalker_f90_double.a</code>. If you've
  configured Skywalker to use single precision floating point numbers with
  <code>-DSKYWALKER_PRECISION=single</code>, replace <code>double</code> with <code>single</code>.</p>
</li>
</ul>
<p>If all goes well, you'll end up with a <code>surface</code> executable.</p>
<h2 id="step-4-run-the-experiment">Step 4: Run the Experiment</h2>
<p>Now it's time to see the program in action. Make sure your <code>surface</code>
executable is in the same directory as your <code>surface.yaml</code> input file,
and run it without arguments:</p>
<pre><code>./surface
</code></pre>
<p>Hopefully, the program runs to completion, generating a <code>surface.py</code> text
file containing the data. You can open up this file in an editor to see how it
looks. The format of this file is described <a href="../output/">here</a>.</p>
<h2 id="step-5-analyze-the-results">Step 5: Analyze the Results</h2>
<p>Here's a simple Python 3 program you can run in the same directory as your
<code>surface.py</code> file to generate a surface plot of $f(x, y)$ over the domain
$[-2\pi, 2\pi] \times [-2\pi, 2\pi]$.</p>
<p>=== "plot_surface.py"
    ``` python
    import matplotlib.pyplot as plt
    import numpy as np</p>
<pre><code># Extract data from surface.py.
import surface
x = np.array(surface.input.x)
y = np.array(surface.input.y)
f = np.array(surface.output.f)

# Plot the contours of f(x, y).
plt.tricontour(x, y, f)
plt.colorbar()

# Display the plot.
plt.show()
```
</code></pre>
<p>The script uses <a href="https://matplotlib.org">matplotlib</a>, which you can often
install with a command like</p>
<pre><code>pip3 install matplotlib
</code></pre>
<p>Run the script to see the plot.</p>
<pre><code>python3 plot_surface.py
</code></pre>
<p>Here's how it looks:</p>
<p><img alt="f(x,y)" src="../images/surface.png" /></p>
<p>That's it. Congratulations--you've successfully used Skywalker to sample a
multivariate function over regularly spaced intervals. If you like, you can
continue through the rest of the documentation to learn how things work. You can
also take a look at <a href="../example/">a more involved example</a> if that's your style.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
